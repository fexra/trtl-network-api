d3.json('./data', function(nodes) {


console.log(nodes)
    var node_color = '#1e5329'

    var mymap = L.map("mapid", {
        zoom: 3,
        minZoom: 2,
        maxZoom: 4
    }).setView([37, 110], 3),
    southWest = L.latLng(-700, -200),
    northEast = L.latLng(700, 200);
    
    bounds = L.latLngBounds(southWest, northEast), mymap.setMaxBounds(bounds), d3.json("./data/world_map.json", function(a, b) {
        function g() {
            for (var a = f.length - 1; a >= 0; a--) f[a].isEnd() ? f[a].isCleaning || (f[a].isCleaning = !0, f[a].delete(), f.splice(a, 1)) : (f[a].update(), f[a].render())
        }
    
        console.log(b);
    
        var c = topojson.feature(b, b.objects.countries);
    
        L.geoJSON(c, {
            style: {
                color: "#5c8700",
                opacity: .5,
                weight: 1,
                fillColor: "black",
                fillOpacity: .2
            }
        }).addTo(mymap);
        
        var d = d3.select("#mapid").select("svg")
        var f = (d.append("g"), [])
    
        mymap.on("zoomend", g), setInterval(function() {
            
            if (f.length < 6 && Math.random() < .2) {

                f.push(new Flight(mymap, d));
                
                var a = Math.floor(3 * Math.random()),
                    b = Math.floor(4 + 10 * Math.random());

                console.log(a + " " + b)
                
                f[f.length - 1].setPlaneColor(node_color), f[f.length - 1].setRoadColor(node_color), f[f.length - 1].setBeginColor(node_color), f[f.length - 1].setEndColor(node_color), f[f.length - 1].init({
                    lat: nodes[a].coordinates[0],
                    lng: nodes[a].coordinates[1]
                }, {
                    lat: nodes[b].coordinates[0],
                    lng: nodes[b].coordinates[1]
                })
            }
            g()
        }, 25)
    })
})
